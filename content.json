{"pages":[{"title":"404","text":"","path":"404/index.html","date":"04-24","excerpt":""},{"title":"about","text":"","path":"about/index.html","date":"04-24","excerpt":""},{"title":"search","text":"","path":"search/index.html","date":"04-24","excerpt":""}],"posts":[{"title":"æ–‡å­—åŠ¨æ¬¡æ‰“æ¬¡ï¼Œè®©æ–‡å­—åŠ¨æ€ç»˜åˆ¶å‡ºæ¥","text":"æœ¬æ–‡å±äºAndroidæŠ€æœ¯è®ºè¿°æ–‡ç« ï¼Œé˜…è¯»å®Œå¤§è‡´éœ€è¦äº”åˆ†é’Ÿ åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ æ²¡æ—¶é—´çš„å°ä¼™ä¼´å¯ä»¥ç›´æ¥è·³è¿‡æ–‡ç« ï¼Œç‚¹å‡»é¡¹ç›®åœ°å€ï¼Œå¦‚æœå–œæ¬¢çš„è¯ï¼Œé¡ºæ‰‹ç»™ä¸ªstaré‚£æ˜¯æå¥½çš„ã€å¨‡ç¾â€¦â€¦ã€‘ äºŒè¯ä¸è¯´ï¼Œæ•ˆæœå¥‰ä¸Šï¼ çŸ¥è¯†ç‚¹åºåˆ—ï¼š Canvasç»˜åˆ¶ TextPaint Path PathMeasureã€æµ‹é‡Pathã€‘ ä»£ç åˆ†æè·å–æ–‡å­—çš„è½®å»“Pathåœ¨TextPaintä¸­æœ‰è¿™æ ·ä¸€ä¸ªæ–¹æ³•ï¼ŒgetTextPath,å¦‚ä¸‹ï¼š 12345678public void getTextPath(String text, int start, int end, float x, float y, Path path) &#123; if ((start | end | (end - start) | (text.length() - end)) &lt; 0) &#123; throw new IndexOutOfBoundsException(); &#125; nGetTextPath(mNativePaint, mNativeTypeface, mBidiFlags, text, start, end, x, y, path.mutateNI()); &#125; ğŸ‘€å…¶ä¸­nGetTextPathé‡Œé¢æ˜¯è°ƒç”¨äº†ä¸€ä¸ªåŸç”Ÿå‡½æ•°ï¼Œå…·ä½“å®ç°ä¸å¿…ç†ä¼šã€‚åªéœ€è¦äº†è§£å‡½æ•°çš„å„ä¸ªå‚æ•°å°±å¯ä»¥äº†ã€‚ å‚æ•°å«ä¹‰ï¼š textï¼šæ–‡æœ¬å†…å®¹ startï¼šéœ€è¦æµ‹é‡çš„æ–‡æœ¬ä¸­çš„ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ä¸‹æ ‡ endï¼šéœ€è¦æµ‹é‡çš„æ–‡æœ¬æœ€åä¸€ä¸ªå­—ç¬¦çš„ä¸‹æ ‡åŠ 1 xï¼šPathèµ·ç‚¹çš„åæ ‡X yï¼šPathèµ·ç‚¹çš„åæ ‡Y pathï¼šæœ€ç»ˆæµ‹é‡å¾—åˆ°çš„Path Pathåˆ†æ®µç»˜åˆ¶PathMeasureè¿™ä¸ªç±»å¯ä»¥è¯´æ˜¯Pathç›¸å…³çš„å·¥å…·è§£æç±»ï¼Œé‡Œé¢å¤§å¤šæ˜¯åŸç”Ÿå‡½æ•°ï¼Œå®ç°ç»†èŠ‚ä¸å¿…æ·±ç©¶ã€‚åªéœ€è¦ä¼šä½¿ç”¨æ–¹æ³•å³å¯ã€‚ç¬¬ä¸€æ­¥æˆ‘ä»¬å¾—åˆ°æ–‡å­—çš„è½®å»“Pathä¹‹åï¼Œè¿™ä¸€æ­¥å°†æ­¤pathæŒ‰æ®µç»˜åˆ¶å‡ºæ¥å³å¯ã€‚åœ¨ä»£ç ä¸­ï¼Œç”±CanvasViewè¿™ä¸ªç±»æ¥å…·ä½“å®ç°ç»˜åˆ¶çš„è¯¦å°½æµç¨‹ã€‚çœ‹ä»£ç ï¼Œå°†æ–‡æœ¬è½®å»“Pathè®¾ç½®è¿›æ¥ï¼š 123456789101112131415161718// ä¿ç•™ä¸€ä»½åŸå§‹Pathï¼Œç”¨ä½œç»˜åˆ¶æœ€ç»ˆå¡«è‰²çš„æ–‡å­— mOrignalPath = orignalPath; if (null == mPathMeasure) &#123; mPathMeasure = new PathMeasure(); &#125; //å…ˆé‡ç½®ä¸€ä¸‹éœ€è¦æ˜¾ç¤ºåŠ¨ç”»çš„path mAnimPath.reset(); mAnimPath.moveTo(0, 0); mPathMeasure.setPath(orignalPath, false); // getLengthï¼ˆï¼‰æ–¹æ³•è·å¾—çš„æ˜¯å½“å‰pathçš„é•¿åº¦ï¼›è€ŒnextContourï¼ˆï¼‰æ–¹æ³•æ˜¯å°†Pathåˆ‡æ¢åˆ°ä¸‹ä¸€æ®µPathï¼Œå¤šåº”ç”¨åœ¨å¤æ‚pathä¸­ mTextCount = 0; // è®¡ç®—æ–‡å­—æ€»å…±æœ‰å¤šå°‘æ®µPath while (mPathMeasure.nextContour()) &#123; mTextCount++; &#125; // PathMeasureé‡æ–°è®¾ç½®ä¸€æ¬¡ mPathMeasure.setPath(orignalPath, false); mPaint.setStyle(Paint.Style.STROKE); å…¶ä¸­æˆå‘˜å˜é‡mAnimPathï¼Œå³æ˜¯ç”¨åœ¨onDraw()æ–¹æ³•å†…ç”¨äºç»˜åˆ¶çš„Pathã€‚æˆ‘ä»¬ä¼šä¸åœåœ°é€šè¿‡PathMeasureåˆ·æ–°è¿™ä¸ªPathï¼Œç”¨äºåŠ¨ç”»æµç•…è¿è¡Œã€‚ æ¥ä¸‹æ¥æ˜¯å¼•æ“ä»£ç ï¼Œä½¿ç”¨çš„æ˜¯å±æ€§åŠ¨ç”»ï¼Œçœ‹ä»£ç å®ç°ï¼š 1234567891011121314151617181920212223242526272829if (null == mValueAnimator) &#123; // å¦‚æœä¸€ä¸ªæ–‡æœ¬PathåŒ…å«nä¸ªå°Pathï¼Œé‚£ä¹ˆå±æ€§åŠ¨ç”»ä¼šRepeatè¿è¡Œnæ¬¡ï¼Œæ¯ä¸€æ®µå°pathé»˜è®¤åŠ¨ç”»æ—¶é—´ä¸º900ms mValueAnimator = ValueAnimator.ofFloat(0.0f, 1.0f); mValueAnimator.setDuration(900); mValueAnimator.setInterpolator(new LinearInterpolator()); &#125; // å¼•æ“æ— é™æ¬¡é‡å¤å‘åŠ¨ mValueAnimator.setRepeatCount(ValueAnimator.INFINITE); mValueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123; @Override public void onAnimationUpdate(ValueAnimator animation) &#123; float value = (float) animation.getAnimatedValue(); // å°†ä¸€æ®µå°Pathä»0%åˆ°100%èµ‹å€¼åˆ°mAnimPathä¸­ï¼Œè°ƒç”¨é‡ç»˜ mPathMeasure.getSegment(0, mPathMeasure.getLength() * value, mAnimPath, true); invalidate(); &#125; &#125;); mValueAnimator.addListener(new AnimatorListenerAdapter() &#123; @Override public void onAnimationRepeat(Animator animation) &#123; super.onAnimationRepeat(animation); //ç»˜åˆ¶å®Œä¸€æ¡Pathä¹‹åï¼Œå†ç»˜åˆ¶ä¸‹ä¸€æ¡ï¼Œç›´åˆ°å®Œæˆä¸ºæ­¢ã€‚ if (!mPathMeasure.nextContour()) &#123; animation.end(); &#125; invalidate(); &#125; &#125;); æ³¨é‡Šé‡Œå…·ä½“åŸå› äº¦å·²å†™æ˜ã€‚è¿™ç§å¼•æ“çš„è®¾ç½®ï¼Œå°±æ˜¯æ¯ä¸€å°æ®µPathä¸ç®¡é•¿çŸ­ï¼Œå…¶ç»˜åˆ¶æ—¶é—´éƒ½æ˜¯ç›¸ç­‰çš„ï¼Œä¼šé€ æˆåŠ¨ç”»çœ‹èµ·æ¥æ—¶æ…¢æ—¶å¿«ã€‚ å…¶å®è¦è®©åŠ¨ç”»ä¸€ç›´åŒ€é€Ÿè·‘èµ·æ¥ä¹Ÿå¾ˆå®¹æ˜“ï¼Œå°±æ˜¯æå‰å°†åŸå§‹Pathæµ‹é‡ä¸€éï¼Œè®¾ç½®ä¸€ä¸ªæ€»æ—¶é—´ï¼Œç„¶åæ ¹æ®å°Pathçš„é•¿çŸ­æ¥æŒ‰ç…§æ¯”ä¾‹åˆ†é…æ—¶é—´ã€‚è¿™æ ·å³å¯ä½¿åŠ¨ç”»åŒ€é€Ÿè¿›è¡Œã€‚å…·ä½“ä»£ç ä¸å†å¤šè¨€ğŸ˜˜ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è¯•è¯•ã€‚ å†çœ‹çœ‹CanvasViewå†…çš„onDraw()æ–¹æ³•å®ç°ï¼š 12345678910@Override protected void onDraw(Canvas canvas) &#123; super.onDraw(canvas); if (null != mPathMeasure &amp;&amp; mPathMeasure.getLength() == 0) &#123; mPaint.setStyle(Paint.Style.FILL); canvas.drawPath(mOrignalPath, mPaint); return; &#125; canvas.drawPath(mAnimPath, mPaint); &#125; è¿™é‡Œé¢çš„ä»£ç æ›´åŠ ç®€å•ï¼Œåœ¨Pathç»˜åˆ¶å®Œä¹‹å‰ï¼Œä¸€ç›´ç»˜åˆ¶mAnimPathå³å¯ã€‚Pathç»˜åˆ¶å®Œä¹‹åï¼Œè®¾ç½®ç”»ç¬”çš„ç»˜åˆ¶é£æ ¼ï¼Œå°†æ–‡å­—ç©ºç™½å¤„å¡«ä¸Šè‰²å³å¯ã€‚ ä»¥ä¸Šã€‚å°±æ˜¯æœ¬æ¬¡é¡¹ç›®çš„ä¸»è¦æ€è·¯è§£æã€‚å¤§å®¶èµ°è¿‡è·¯è¿‡ä¸è¦é”™è¿‡ï¼Œç»™æ·»ä¸ªStarå‘—ğŸ˜„ã€‚","path":"2017/11/02/anim_text/","date":"11-02","excerpt":"","tags":[{"name":"CanvasåŠ¨ç”»","slug":"CanvasåŠ¨ç”»","permalink":"https://yoursite.com/tags/CanvasåŠ¨ç”»/"},{"name":"Android","slug":"Android","permalink":"https://yoursite.com/tags/Android/"}],"preview":"https://raw.githubusercontent.com/JadynAi/oldpage.io/master/img/20170819-blog-header-bg.jpg"},{"title":"å®ç°è–„è·LoadingåŠ¨ç”»","text":"æœ¬æ–‡å±äºAndroidæŠ€æœ¯è®ºè¿°æ–‡ç« ï¼Œé˜…è¯»å®Œå¤§è‡´éœ€è¦äº”åˆ†é’Ÿ åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ æ²¡æ—¶é—´çš„å°ä¼™ä¼´å¯ä»¥ç›´æ¥è·³è¿‡æ–‡ç« ï¼Œç‚¹å‡»é¡¹ç›®åœ°å€ï¼Œå¦‚æœå–œæ¬¢çš„è¯ï¼Œé¡ºæ‰‹ç»™ä¸ªstaré‚£æ˜¯æå¥½çš„ã€å¨‡ç¾â€¦â€¦ã€‘ å¥½å§ã€‚å…ˆè¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆè¦åšè¿™ä¸ªé¡¹ç›®ã€‚å‰å‡ å¤©ä½¿ç”¨è–„è·çš„æ—¶å€™ï¼Œå‡‘å·§çœ‹åˆ°äº†è¿™ä¸ªLoadingåŠ¨ç”»ï¼Œè§‰å¾—æ•ˆæœè¿˜ä¸é”™ã€‚å°±æƒ³å°è¯•ç€å®ç°ä¸€ä¸‹ã€‚å…ˆçœ‹ä¸€ä¸‹åŸç‰ˆçš„æ•ˆæœï¼ŒGIFå½•åˆ¶çš„æ¯”è¾ƒå¿«ï¼Œä½†åº”è¯¥è¿˜å¯ä»¥çœ‹æ¸…æ¥šã€‚ å…ˆä¸Šæœ¬æ¬¡æœ€ç»ˆå®ç°çš„æ•ˆæœå›¾å§ï¼Œé¢œè‰²å½“ç„¶é€‰æ‹©ä»Šå¹´æœ€æµè¡Œçš„åŸè°…è‰²ï¼š æ€è·¯åˆ†æ 1ã€æ•´ä¸ªå›¾å½¢çš„å½¢çŠ¶å¦‚ä½•ç»˜åˆ¶ 2ã€å¦‚ä½•è®©çº¿æ¡åŠ¨èµ·æ¥ æ•´ä¸ªå›¾å½¢çš„å½¢çŠ¶åˆ†æ å¥½äº†ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™ä¸ªå›¾æ¡ˆï¼Œå¦‚æœæ˜¯é™æ€çš„ï¼Œé‚£ä¹ˆå¦‚ä½•ç»˜åˆ¶ï¼Ÿå¾ˆç®€å•ï¼Œæ‹†åˆ†ã€‚æˆ‘ä»¬å°†å›¾å½¢æ‹†å¼€åˆ†è§£ï¼Œç„¶åå†çœ‹ã€‚åˆ†æç»†èŠ‚å’Œæ­¥éª¤ï¼Œè¿™æ˜¯è¦ç‚¹ã€‚æˆ‘è¿™é‡Œå°†è¿™ä¸ªå›¾åˆ†æˆäº†ä¸‰ä»½ã€‚ ç¬¬ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯å¶æŸ„ã€‚ä¹Ÿå°±æ˜¯ä¸‹é¢é‚£ä¸€æ¡å°å°çš„ç«–çº¿ã€‚åŸLoadingå›¾ä¸­ä¸ç”šæ˜æ˜¾ï¼Œä½†è¿˜æ˜¯æœ‰çš„ã€‚å¶æŸ„æ²¡ä»€ä¹ˆè¯´çš„ï¼Œç›´çº¿å°±å¯ä»¥äº†ã€‚ ç¬¬äºŒä¸ªï¼Œå¶å­çš„å·¦è½®å»“è¾¹ç¼˜å’Œå³è½®å»“è¾¹ç¼˜ã€‚è¿™æ˜¯ä¸€æ®µä¸‹è‚¥ä¸Šçª„çš„å¼§çº¿ï¼Œæ¤­åœ†æˆªå–æ„Ÿè§‰ä¸å¦¥ï¼Œæˆ‘è¿™é‡Œé‡‡ç”¨çš„æ˜¯è´å¡å°”äºŒé˜¶æ›²çº¿ã€‚æœ‰å…³Androidè´å¡å°”ç›¸å…³çš„çŸ¥è¯†å¤§å®¶å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« ã€‚ ç¬¬ä¸‰ä¸ªï¼Œä¹Ÿå°±æ˜¯å¶ç‰‡çš„è„‰ç»œï¼Œçº¿å’Œçº¿äº¤å‰è¿æ¥ï¼Œæ²¡ä»€ä¹ˆå¯è¯´çš„ã€‚ é‚£ä¹ˆé‡ç‚¹å…¶å®å°±æ˜¯å¶å­å·¦å³è½®å»“çš„ç»˜åˆ¶äº†ï¼Œæˆ‘ç”»äº†ä¸€å¼ è‰å›¾ã€‚å¤§å®¶å¯ä»¥çœ‹çœ‹ï¼š å…¶ä¸­é»‘è‰²çš„æ¡†ä½œä¸ºViewçš„è¾¹ç•Œã€‚Aç‚¹æ˜¯å·¦è½®å»“æ›²çº¿çš„èµ·ç‚¹ï¼ŒBç‚¹äº‹è´å¡å°”æ›²çº¿çš„æ§åˆ¶ç‚¹ï¼Œæˆ‘æŠŠå®ƒå®šä¹‰åˆ°äº†Viewçš„å·¦è¾¹æ¡†é‚£é‡Œã€‚Cç‚¹äº‹æ•´ä¸ªè´å¡å°”æ›²çº¿çš„ç»ˆç‚¹ï¼ŒDç‚¹åˆ™æ˜¯å®é™…ä¸Šæ›²çº¿çš„æœ€é«˜ç‚¹ã€‚å³è½®å»“åˆ™å’Œå·¦è½®å»“æ˜¯é•œåƒå­˜åœ¨ã€‚å›¾æœ‰ç‚¹æ½¦è‰ï¼Œä¸è¿‡åº”è¯¥è¿˜çœ‹å¾—æ‡‚ã€‚ å¥½äº†ï¼Œé™æ€å›¾å½¢æ‹†è§£å®Œæ¯•ã€‚æ¥ç€çœ‹ï¼Œå¦‚ä½•è®©å›¾åŠ¨èµ·æ¥ã€‚ å¦‚ä½•è®©çº¿æ¡åŠ¨èµ·æ¥æ•´ä¸ªé¡¹ç›®ä¸­ï¼Œå¦‚ä½•è®©çº¿æ¡çœŸæ­£çš„åŠ¨èµ·æ¥æ‰æ˜¯è¦ç‚¹ã€‚åˆšå¼€å§‹åœ¨è¿™é‡Œçš„æ€è·¯ï¼Œæ˜¯æƒ³ä½¿ç”¨canvas.drawCircleç»˜åˆ¶åœ¨ä¸€å¼ Bitmapä¸Šï¼Œä»¥ç‚¹æ±‡é¢ã€‚åé¢å®ç°èµ·æ¥å‘ç°ï¼Œè¿™ç§æ–¹å¼ç‰¹åˆ«ä¸é è°±ã€‚ä¸ºä»€ä¹ˆä¸é è°±å‘¢ï¼Ÿå› ä¸ºç‚¹è¿æ¥æˆçº¿ï¼Œæ¯æ¬¡ç§»åŠ¨çš„é€Ÿç‡å’Œè·ç¦»éƒ½å¾—è®¡ç®—ï¼Œå¾ˆéº»çƒ¦ã€‚å¾ˆå®¹æ˜“å‡ºç°æ–­ç‚¹çš„æƒ…å†µã€‚æœ€åï¼Œæˆ‘é‡‡ç”¨çš„æ˜¯è®©canvaså»ç»˜åˆ¶ä¸€æ®µPathè·¯å¾„ï¼Œç„¶åPathè·¯å¾„ä¸åœçš„åˆ·æ–°æ”¹å˜ã€‚è¿™æ ·åšçš„å¥½å¤„ï¼Œæ˜¯Pathæ›´åŠ ç›´è§‚æ˜“äºæ§åˆ¶ã€‚è€Œä¸”è¿˜ä¸ç”¨å¤šç»˜åˆ¶ä¸€å¼ Bitmapã€‚æ•´ä¸ªé¡¹ç›®ä¸­ï¼Œè‡ªå®šä¹‰çš„Viewï¼ŒLeafAnimViewåšçš„å·¥ä½œå¾ˆå°‘ï¼Œåªæ˜¯åœ¨onDrawæ–¹æ³•å†…ï¼Œè°ƒèµ·äº†ç»˜åˆ¶è€Œå·²ã€‚å…·ä½“çš„ç»˜åˆ¶éƒ½äº¤ç»™LeafAtomäº†ã€‚é¢å‘å¯¹è±¡å˜›ã€‚ å…·ä½“çš„æ€è·¯ï¼Œæ˜¯æˆ‘æŠŠæ€»æ—¶é—´æŒ‰æ¯”ä¾‹åˆ†æˆå››éƒ¨åˆ†ã€‚ç”Ÿæˆå››ä¸ªå±æ€§åŠ¨ç”»ï¼Œåœ¨å±æ€§åŠ¨ç”»çš„ç›‘å¬é‡Œä½œPathçš„xå’Œyçš„å˜åŒ–ã€‚åœ¨ç»˜åˆ¶çš„æ—¶å€™ï¼Œåªéœ€è¦å°†è¿™å››ä¸ªåŠ¨ç”»ä¾æ¬¡æ’­æ”¾ï¼Œå³å¯å¾—åˆ°æ¯ä¸ªæ—¶é—´æ®µçš„å…·ä½“è¿åŠ¨å€¼ã€‚è€Œä¸”è¿˜æ˜¯å‡åŒ€å˜åŒ–çš„ã€‚ LeafAnimViewå†…éƒ¨ä½œä¸ºåŠ¨ç”»å¼•æ“çš„æ˜¯ä¸€ä¸ªValueAnimator,ä½¿ç”¨å®ƒæ¥è§¦å‘Viewçš„onDrawã€‚åŒæ—¶ä¹Ÿä½¿ç”¨å®ƒæ¥æ§åˆ¶æ•´ä¸ªåŠ¨ç”»çš„æ—¶é—´ã€‚ 123456789mValueAnimator = ValueAnimator.ofFloat(0, 1); mValueAnimator.setDuration(5000); mValueAnimator.setRepeatCount(ValueAnimator.INFINITE); mValueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123; @Override public void onAnimationUpdate(ValueAnimator animation) &#123; invalidate(); &#125; &#125;); LeafAtomç±»å†…éƒ¨æ¥å—åˆ°è¿™ä¸ªæ€»æ—¶é•¿ï¼Œç„¶åå°†è¿åŠ¨æ€»æ—¶é—´åˆ†å‰²ï¼Œæ ¹æ®æ¯”ä¾‹è®¡ç®—å‡ºç»˜åˆ¶å¶æŸ„ã€å·¦å³è½®å»“ã€è„‰ç»œçš„åŠ¨ç”»æ—¶é—´ã€‚ 123456789101112131415161718192021222324252627282930313233343536-------åœ¨LeafAnimViewç±»å†…éƒ¨--------- @Override protected void onDraw(Canvas canvas) &#123; super.onDraw(canvas); if (null == mLeafAtom) &#123; //ä¼ å…¥æ€»æ—¶é•¿ mLeafAtom = new LeafAtom(getWidth(), getHeight(), mValueAnimator.getDuration()); &#125; if (!mValueAnimator.isStarted()) &#123; mValueAnimator.start(); &#125; //å¼€å§‹ç»˜åˆ¶ mLeafAtom.drawGraph(canvas, mPaint); &#125; -------åœ¨LeafAtomeç±»---------------public static final float PETIOLE_RATIO = 0.1f;//å¶æŸ„æ‰€å æ¯”ä¾‹public LeafAtom(int width, int height, long duration) &#123; mWidth = width; mHeight = height; mPetioleTime = (long) (duration * PETIOLE_RATIO);//ç»˜åˆ¶å¶æŸ„çš„æ—¶é—´ mArcTime = (long) (duration * (1 - PETIOLE_RATIO) * 0.4f);//å·¦å³è½®å»“å¼§çº¿çš„æ—¶é—´ mLastLineTime = duration - mPetioleTime - mArcTime * 2;//æœ€åä¸€æ®µå¶è„‰çš„æ—¶é—´ mBezierBottom = new PointF(mWidth * 0.5f, mHeight * (1 - PETIOLE_RATIO));//å·¦ä¾§è½®å»“åº•éƒ¨ç‚¹ mBezierControl = new PointF(0, mHeight * (1 - 3 * PETIOLE_RATIO));//å·¦ä¾§è½®å»“æ§åˆ¶ç‚¹ mBezierTop = new PointF(mWidth * 0.5f, 0);//å·¦ä¾§è½®å»“é¡¶éƒ¨ç»“æŸç‚¹ mVeinBottomY = mHeight * (1 - PETIOLE_RATIO) - 10;//å³ä¾§è½®å»“åº•éƒ¨ç‚¹Yè½´åæ ‡ï¼Œç¨ç¨ä½ä¸€ç‚¹ mOneNodeY = mVeinBottomY * 4 / 5;//ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„Yè½´åæ ‡ mTwoNodeY = mVeinBottomY * 2 / 5;//ç¬¬äºŒä¸ªèŠ‚ç‚¹Yè½´åæ ‡ initEngine(); setOrginalStatus(); &#125; åœ¨LeafAtomçš„æ„é€ å‡½æ•°ä¸­ï¼Œå¾—åˆ°æ¯ä¸€ä¸ªé˜¶æ®µåŠ¨ç”»çš„æ—¶é—´ï¼Œç„¶åç”Ÿæˆå››ä¸ªå±æ€§åŠ¨ç”»ï¼Œåœ¨è¿™ä¸ªå±æ€§åŠ¨ç”»çš„ç›‘å¬é‡Œå»åšPathçš„xå’Œyåæ ‡çš„å€¼å˜åŒ–ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374/** * åˆå§‹åŒ–pathå¼•æ“ */ private void initEngine() &#123; //å¶æŸ„åŠ¨ç”»ï¼ŒYè½´å˜åŒ–ç”±åº•éƒ¨è¿åŠ¨åˆ°å¶æŸ„é«˜åº¦çš„åœ°æ–¹ mPetioleAnim = ValueAnimator.ofFloat(mHeight, mHeight * (1 - PETIOLE_RATIO)).setDuration(mPetioleTime); //å·¦å³è½®å»“è´å¡å°”æ›²çº¿ï¼Œåªéœ€è¦åªå¥¥æ—¶é—´å˜åŒ–æ˜¯ä»0~1çš„ã€‚èµ·ç‚¹ã€æ§åˆ¶ç‚¹ã€ç»“æŸç‚¹éƒ½çŸ¥é“äº† mArcAnim = ValueAnimator.ofFloat(0, 1.0f).setDuration(mArcTime); //ç»˜åˆ¶å¶è„‰çš„åŠ¨ç”» mLastAnim = ValueAnimator.ofFloat(mVeinBottomY, 0).setDuration(mLastLineTime); mPetioleAnim.setInterpolator(new LinearInterpolator()); mArcAnim.setInterpolator(new LinearInterpolator()); mLastAnim.setInterpolator(new LinearInterpolator()); mArcRightAnim = mArcAnim.clone(); mPetioleAnim.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123; @Override public void onAnimationUpdate(ValueAnimator animation) &#123; mY = (float) animation.getAnimatedValue(); &#125; &#125;); mArcAnim.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123; @Override public void onAnimationUpdate(ValueAnimator animation) &#123; computeArcPointF(animation, true); &#125; &#125;); mArcRightAnim.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123; @Override public void onAnimationUpdate(ValueAnimator animation) &#123; computeArcPointF(animation, false); &#125; &#125;); mLastAnim.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123; @Override public void onAnimationUpdate(ValueAnimator animation) &#123; mY = (float) animation.getAnimatedValue(); float tan = (float) Math.tan(Math.toRadians(30)); if (mY &lt;= mOneNodeY &amp;&amp; mY &gt; mTwoNodeY) &#123; mOneLpath.moveTo(mX, mOneNodeY); mOneRpath.moveTo(mX, mOneNodeY); //è¿™é‡Œçš„å‚æ•°xå’Œyä»£è¡¨ç›¸å¯¹å½“å‰ä½ç½®åç§»é‡ï¼Œyè½´ä¸åŠ åç§»é‡ä¼šç©ºä¸€æˆªå‡ºæ¥ï¼Œè¿™é‡Œçš„15æ˜¯ç»éªŒå€¼ mMainPath.addPath(mOneLpath, 0, EXPRIENCE_OFFSET); mMainPath.addPath(mOneRpath, 0, EXPRIENCE_OFFSET); //ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å’Œç¬¬äºŒä¸ªèŠ‚ç‚¹ä¹‹é—´ float gapY = mOneNodeY - mY; mOneLpath.rLineTo(-gapY * tan, -gapY); mOneRpath.lineTo(mX + gapY * tan, mY); &#125; else if (mY &lt;= mTwoNodeY) &#123; mTwoLpath.moveTo(mX, mTwoNodeY); mTwoRpath.moveTo(mX, mTwoNodeY); //ç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼Œä¸ºé¿å…çº¿è¶…å‡ºå¶å­ï¼Œå–æ­¤æ—¶å·®å€¼çš„ä¸€åŠä½œè®¡ç®— float gapY = (mTwoNodeY - mY) * 0.5f; mMainPath.addPath(mTwoLpath, 0, EXPRIENCE_OFFSET); mMainPath.addPath(mTwoRpath, 0, EXPRIENCE_OFFSET); mTwoLpath.rLineTo(-gapY * tan, -gapY); mTwoRpath.rLineTo(gapY * tan, -gapY); &#125; &#125; &#125;); mEngine = new AnimatorSet(); mEngine.playSequentially(mPetioleAnim, mArcAnim, mArcRightAnim, mLastAnim); mEngine.addListener(new AnimatorListenerAdapter() &#123; @Override public void onAnimationEnd(Animator animation) &#123; super.onAnimationEnd(animation); setOrginalStatus(); &#125; &#125;); &#125; è®¡ç®—è´å¡å°”æ›²çº¿è¿åŠ¨è¿‡ç¨‹ä¸­çš„æ–¹æ³•ã€‚è´å¡å°”æ›²çº¿æ˜¯æœ‰ä¸€ä¸ªå‡½æ•°çš„ï¼Œæˆ‘ä»¬çŸ¥é“èµ·ç‚¹ã€æ§åˆ¶ç‚¹ã€ç»ˆç‚¹çš„è¯ï¼Œå°±å¯ä»¥æ ¹æ®æ—¶é—´è®¡ç®—å‡ºæ­¤æ—¶æ­¤åˆ»çš„xå’Œyçš„åæ ‡ã€‚è€Œè¿™ä¸ªæ—¶é—´å˜åŒ–æ˜¯ä»0~1å˜åŒ–çš„ã€‚è°¨è®°ã€‚ 1234567891011121314151617private void computeArcPointF(ValueAnimator animation, boolean isLeft) &#123; float ratio = (float) animation.getAnimatedValue(); //ratioä»0~1å˜åŒ–ï¼Œå·¦å³è½®å»“ä¸‰ä¸ªç‚¹ä¸ä¸€æ · PointF bezierStart = isLeft ? mBezierBottom : mBezierTop; PointF bezierControl = isLeft ? mBezierControl : new PointF(mWidth, mHeight * (1 - 3 * PETIOLE_RATIO)); PointF bezierEnd = isLeft ? mBezierTop : new PointF(mWidth * 0.5f, mVeinBottomY); PointF pointF = calculateCurPoint(ratio, bezierStart, bezierControl, bezierEnd); mX = pointF.x; mY = pointF.y; &#125; private PointF calculateCurPoint(float t, PointF p0, PointF p1, PointF p2) &#123; PointF point = new PointF(); float temp = 1 - t; point.x = temp * temp * p0.x + 2 * t * temp * p1.x + t * t * p2.x; point.y = temp * temp * p0.y + 2 * t * temp * p1.y + t * t * p2.y; return point; &#125; å¶è„‰çš„ç»˜åˆ¶ï¼Œåœ¨èŠ‚ç‚¹ä¸€å’ŒèŠ‚ç‚¹äºŒï¼Œåˆ†åˆ«åŠ ä¸Šä¸¤ä¸ªå‘å·¦å’Œå‘å³ä¼¸å±•å¼€çš„Pathè·¯å¾„å³å¯ã€‚ éœ€è¦è¯´æ˜çš„æ˜¯ï¼ŒlineToå’ŒrLineToçš„åŒºåˆ«ï¼ŒlineToçš„å‚æ•°ä»£è¡¨çš„å°±æ˜¯ç›®æ ‡å‚æ•°ï¼Œè€ŒrLineToçš„å‚æ•°ä»£è¡¨çš„æ˜¯ï¼Œç›®æ ‡å‚æ•°å’Œèµ·ç‚¹å‚æ•°çš„å·®å€¼ã€‚ æœ€ååœ¨drawGraphå‡½æ•°ä¸­ï¼Œå¯åŠ¨è¿™ä¸ªåŠ¨ç”»é›†åˆï¼š 12345678public void drawGraph(Canvas canvas, Paint paint) &#123; if (mEngine.isStarted()) &#123; canvas.drawPath(mMainPath, paint); mMainPath.lineTo(mX, mY); &#125; else &#123; mEngine.start(); &#125; &#125; ä»¥ä¸Šï¼Œå°±æ˜¯æœ¬æ¬¡é¡¹ç›®çš„ä¸»è¦æ€è·¯äº†ã€‚ç›¸å…³æ³¨é‡Šä»£ç é‡Œéƒ½å†™çš„å¾ˆæ¸…æ¥šäº†ï¼Œé¡¹ç›®åœ°å€åœ¨è¿™é‡Œã€‚ä»¿è–„è·LoadingåŠ¨ç”»ï¼Œå¤§å®¶èµ°è¿‡è·¯è¿‡åƒä¸‡åˆ«å¿˜äº†ç»™ä¸ªStarå•Šã€‚","path":"2017/08/19/bohe_path/","date":"08-19","excerpt":"","tags":[{"name":"CanvasåŠ¨ç”»","slug":"CanvasåŠ¨ç”»","permalink":"https://yoursite.com/tags/CanvasåŠ¨ç”»/"},{"name":"Android","slug":"Android","permalink":"https://yoursite.com/tags/Android/"}],"preview":"https://raw.githubusercontent.com/JadynAi/oldpage.io/master/img/20170819-blog-header-bg.jpg"},{"title":"å®ç”¨æ€§MAX!åƒæ™®é€šViewä¸€æ ·è‡ªç”±ä½¿ç”¨çš„ç²’å­ç»„ä»¶","text":"åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ä¹‹å‰ä½œè¿‡ä¸€ç¯‡è¤ç«è™«é£èˆç²’å­æ•ˆæœï¼Œå½“æ—¶çœ‹è¿˜ä¸é”™ã€‚æ— è®ºæ˜¯æ€§èƒ½è¿˜æ˜¯UIéƒ½æ»¡è¶³äº†å½“æ—¶çš„è®¾è®¡æ•ˆæœï¼Œä½†å®é™…åº”ç”¨åˆ°é¡¹ç›®ä¸­ï¼Œå´å‘ç°ç”±äºSurfaceViewå…¶æœ¬èº«æ˜¯ç»˜åˆ¶åœ¨windowå±‚é¢ä¸Šçš„ï¼Œå¯¹Viewæœ¬èº«çš„å±æ€§æœ‰å¾ˆå¤šçš„é™åˆ¶ï¼Œç”¨èµ·æ¥å´ä¸æ˜¯å¾ˆå®åœ¨ï¼Œè¿˜å­˜åœ¨ç€å¾ˆå¤šä¸è¶³ã€‚ äºæ˜¯ä¾¿å°†ä¹‹å‰çš„æ•ˆæœé‡æ–°å†™äº†ä¸€ä¸‹ï¼Œæ”¹ç”¨ç»§æ‰¿Viewæ¥å®ç°ï¼Œè™½ç„¶è¯´å’ŒSurfaceViewç›¸æ¯”ï¼Œåœ¨ç»˜åˆ¶æ€§èƒ½ä¸Šæœ‰é‚£ä¹ˆä¸€ä¸ä¸çš„ä¸è¶³ ã€‚ä½†è½®å­æœ¬è´¨çš„å«ä¹‰è¿˜æ˜¯ä¸ºäº†æœåŠ¡äºé¡¹ç›®ï¼Œé¡¹ç›®ä¸­æ–¹ä¾¿çš„ä½¿ç”¨æ‰æ˜¯æœ€é‡è¦çš„ã€‚ é˜…è¯»æœ¬æ–‡ï¼Œå¤§æ¦‚éœ€è¦ä¸‰åˆ†åŠé’Ÿã€‚å¦‚æœéœ€è¦ç›´è§‚çœ‹ä»£ç çš„è¯è¯·ç‚¹è¿™é‡Œç‚¹è¿™é‡Œï¼ï¼é¦–å…ˆçœ‹ä¸€ä¸‹æ•ˆæœå›¾ æ¥ç€åˆ†æå®ç°è¿‡ç¨‹ä¸­çš„å‡ ä¸ªé—®é¢˜ å¦‚ä½•ä¿æŒä¸é—´æ–­çš„ç»˜åˆ¶ ç²’å­çš„è¿åŠ¨è½¨è¿¹æ§åˆ¶ï¼ˆéšæœºæ–¹å‘ï¼Œç¢°åˆ°è¾¹ç•Œå›å¼¹ä»¥åŠæ—‹è½¬ï¼‰ é—®é¢˜1ï¼šå¦‚ä½•ä¿æŒä¸é—´æ–­çš„ç»˜åˆ¶â€‹ View çš„ç²’å­ç»˜åˆ¶æœ¬èº«å®åœ¨onDrawä¸­è¿›è¡Œçš„ï¼Œæ‰€ä»¥æœ€å¼€å§‹æˆ‘çš„æ–¹æ¡ˆæ˜¯åœ¨canvasç»˜åˆ¶å®Œä¸€æ³¢ä¹‹åï¼Œç»§ç»­è°ƒç”¨ invalidate()æ–¹æ³•ï¼Œè¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªæ­»å¾ªç¯ï¼Œå°±è¾¾åˆ°äº†ä¸é—´æ–­é‡å¤ç»˜åˆ¶çš„æ•ˆæœã€‚ 1234567891011@Overrideprotected void onDraw(Canvas canvas) &#123; super.onDraw(canvas); canvas.save(); //ç²’å­çš„ä¸€æ³¢ç»˜åˆ¶ for (Particle circle : mCircles) &#123; circle.drawItem(canvas); &#125; canvas.restore(); invalidate();&#125; è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œcanvasçš„ç»˜åˆ¶æ˜¯ä¸€ä¸ªé˜»å¡çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯ä»canvas.save()æ–¹æ³•ä¹‹åï¼Œä¸€ç›´åˆ°invalidate()ä¹‹å‰ï¼Œæ˜¯é˜»å¡çš„ã€‚ é‡ç»˜æ˜¯ä¼šä¸€ç›´ç­‰åˆ°æ‰€æœ‰çš„ç²’å­ç»˜åˆ¶å®Œæˆä¹‹åï¼Œæ‰ä¼šç»§ç»­è°ƒèµ·çš„ã€‚ Tipsï¼š canvasçš„saveå’Œrestoreæ–¹æ³•æ˜¯æ­é…ä½¿ç”¨çš„ã€‚saveå­˜å‚¨ä¹‹å‰çš„canvasçŠ¶æ€ï¼Œrestoreæ¢å¤saveä¹‹å‰çš„çŠ¶æ€ã€‚ saveæ–¹æ³•æ˜¯å¯ä»¥å¤šæ¬¡ä½¿ç”¨çš„ï¼Œå¯ä»¥æ­é…ä½¿ç”¨çš„æ˜¯æ–¹æ³•restoreToCount(saveCount)ã€‚å‚æ•°saveCountä»1å¼€å§‹è®¡æ•°ï¼Œè¡¨ç¤ºå¯ä»¥æ¢å¤åˆ°ç¬¬å‡ æ¬¡saveä¹‹å‰çš„çŠ¶æ€ã€‚ â€‹ è¿™ç§æ–¹å¼çš„ç¼ºç‚¹åœ¨demoå®Œæˆä¹‹åå¾ˆæ˜æ˜¾çš„ä½“ç°äº†å‡ºæ¥ã€‚ç¬¬ä¸€ï¼Œé€Ÿåº¦ä¸å¯æ§åˆ¶ï¼Œè­¬å¦‚æœ‰äº›æ—¶å€™æ°æ°éœ€è¦ç²’å­å˜æ…¢ä¸€ç‚¹å‘¢ã€‚ä½¿ç”¨è¿™ç§æ–¹å¼å°±ä¸å¤ªå¥½å®ç°äº†ã€‚ç¬¬äºŒï¼Œç²’å­åŠ¨ç”»çš„æ’­æ”¾å’Œæš‚åœå®ç°èµ·æ¥ä¸ä¼˜é›…ï¼Œè¯šç„¶å†™ä¸€ä¸ªå¸ƒå°”å€¼æ¥æ§åˆ¶ä¹Ÿå¯ä»¥ï¼Œä½†ä¹Ÿéš¾å…â€¦â€¦â€¦â€¦â€¦â€¦å¤ªä¸ä¼˜é›…äº†å§ã€‚åæ­£æˆ‘ä¸ªäººæ˜¯æ¯”è¾ƒä¸å–œæ¬¢å†™è¿™ç§ä»£ç çš„ã€‚ â€‹ é‚£ä¹ˆï¼Œæœ€ç»ˆæˆ‘çš„å®ç°æ–¹å¼ï¼Œæ˜¯é‡‡ç”¨äº†å±æ€§åŠ¨ç”»æ¥å®ç°çš„ï¼Œæ²¡é”™â€”â€”å°±æ˜¯ValueAnimatorã€‚æ¥çœ‹ä»£ç ï¼š 123456789101112private ValueAnimator mParticleAnim;-----------------mParticleAnim = ValueAnimator.ofInt(0).setDuration(30);mParticleAnim.setRepeatCount(ValueAnimator.INFINITE);mParticleAnim.addListener(new AnimatorListenerAdapter() &#123; @Override public void onAnimationRepeat(Animator animation) &#123; super.onAnimationRepeat(animation); Log.d(TAG, &quot;onAnimationRepeat: &quot; + System.currentTimeMillis()); invalidate(); &#125;&#125;); è¿™æ®µä»£ç å±•ç¤ºå‡ºæ¥ï¼Œä½ æ‡‚å¾—ã€‚ åœ¨ä¸€ä¸ªæ— é™å¾ªç¯çš„å±æ€§åŠ¨ç”»é‡Œï¼Œåœ¨Repeatç›‘å¬äº‹ä»¶é‡Œï¼Œè°ƒç”¨Viewçš„invalidateæ–¹æ³•é‡ç»˜ã€‚è¿™æ ·æ¯æ¬¡è§¦å‘é‡ç»˜çš„æ—¶é—´é—´éš”å°±æ˜¯å±æ€§åŠ¨ç”»çš„æŒç»­æ—¶é—´ã€‚ è¦æ˜¯æƒ³æ§åˆ¶ç²’å­çš„è¿åŠ¨é€Ÿç‡ï¼Œé‚£ä¹ˆåªéœ€è¦è°ƒæ•´åŠ¨ç”»çš„æŒç»­æ—¶é—´å³å¯ã€‚ è€Œä¸”å¦‚æœè¦å¯¹å¤–æš´éœ²ç²’å­åŠ¨ç”»å¼€å§‹æˆ–è€…åœæ­¢çš„æ–¹æ³•ï¼Œåªéœ€è¦æ§åˆ¶å±æ€§åŠ¨ç”»çš„startå’Œstopå°±è¡Œäº†ã€‚ é—®é¢˜2ï¼šç²’å­çš„è¿åŠ¨è½¨è¿¹â€‹ åœ¨æ„å»ºè½®å­çš„æ—¶å€™ï¼Œæ€è·¯å…¶å®ä¸€ç›´éƒ½å¾ˆæ¸…æ™°ã€‚Viewå±‚çº§ä¸»è¦æ˜¯è°ƒèµ·å’Œæ§åˆ¶ç»˜åˆ¶ã€‚å…·ä½“è¦ç»˜åˆ¶ä»€ä¹ˆä¸œè¥¿å’Œè·¯çº¿çš„æ§åˆ¶éƒ½ç”±ç²’å­å¯¹è±¡å†…éƒ¨æ¥å®ç°ã€‚è¿™æ ·å°±å¯ä»¥è´¯å½»å•ä¸€åŸåˆ™ï¼Œå„è‡ªè´Ÿè´£å„è‡ªçš„ä¸œè¥¿ï¼Œé™ä½è€¦åˆæ€§ã€‚ â€‹ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç²’å­å¯¹è±¡Particleå†…çš„ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435public Particle(Bitmap drawBitmap, Matrix matrix, Paint paint, float x, float y, int width, int height) &#123; //ç»˜åˆ¶çš„bitmapå¯¹è±¡å’ŒçŸ©é˜µå¯¹è±¡ï¼ŒçŸ©é˜µç”¨æ¥æ§åˆ¶æ—‹è½¬å’Œè¿åŠ¨æ–¹å‘ mDrawBitmap = drawBitmap; mBitmapMatrix = matrix; mDrawBitmapWidth = drawBitmap.getWidth(); mDrawBitmapHeight = drawBitmap.getHeight(); mBitmapCenterX = mDrawBitmapWidth / 2f; mBitmapCenterY = mDrawBitmapHeight / 2f; //ç”»ç¬”å¯¹è±¡ mPaint = paint; //view çš„å®½å’Œé«˜ç”¨æ¥åˆ¤æ–­è¾¹ç•Œ this.mWidth = width; this.mHeight = height; //ç²’å­è¿åŠ¨çš„åæ ‡ this.mX = x; this.mY = y; //ç²’å­çš„å¼€å§‹åæ ‡ mStartX = x; mStartY = y; //x å’Œyè½´çš„è¿åŠ¨æ–¹å‘é€‰æ‹©ï¼Œéšæœºå‡½æ•° mIsAddX = mRandom.nextBoolean(); mIsAddY = mRandom.nextBoolean(); setRandomParm();&#125;private void setRandomParm() &#123; //x å’Œ yè½´æ¯æ¬¡è¿åŠ¨çš„è·ç¦»å’Œæ¯æ¬¡æ—‹è½¬çš„è§’åº¦ï¼Œéšæœºå€¼ mDisX = mRandom.nextInt(2) + 1.2f; mDisY = mRandom.nextInt(2) + 1.2f; mAddDegree = mRandom.nextInt(5) + 3f;&#125; â€‹ è¿åŠ¨è½¨è¿¹è¿™æ–¹é¢åªéœ€è¦éšæœºå‡ºæ¥xå’Œyè½´çš„æ–¹å‘ï¼Œè¿˜æœ‰æ¯æ¬¡é€’å¢æˆ–è€…é€’å‡çš„å€¼å³å¯ã€‚æ€ä¹ˆæ ·æ˜¯ä¸æ˜¯ä¸æ¯«æ²¡æœ‰æŠ€æœ¯éš¾åº¦å•Šã€‚å¥½äº†ï¼Œçœ‹ç»˜åˆ¶å’Œåˆ°è¾¹ç•Œçš„å¤„ç†ä»£ç å§ã€‚ 123456789101112131415161718192021222324252627282930313233343536public void drawItem(Canvas canvas) &#123; //ç»˜åˆ¶ mBitmapMatrix.reset(); mBitmapMatrix.preTranslate(mX += getPNValue(mIsAddX, mDisX), mY += getPNValue(mIsAddY, mDisY)); mBitmapMatrix.preRotate(mDegrees += mAddDegree, mBitmapCenterX, mBitmapCenterY); canvas.drawBitmap(mDrawBitmap, mBitmapMatrix, mPaint); Log.d(TAG, &quot;mX : &quot; + mX); Log.d(TAG, &quot;mY : &quot; + mY); judgeOutline();&#125;private void judgeOutline() &#123; boolean judgeX = mX &lt;= 0 || mX &gt;= (mWidth - mDrawBitmapWidth); boolean judgeY = mY &lt;= 0 || mY &gt;= (mHeight - mDrawBitmapHeight); if (judgeX) &#123; mIsAddX = !mIsAddX; mIsAddY = mRandom.nextBoolean(); setRandomParm(); if (mX &lt;= 0) &#123; mX = 0; &#125; else &#123; mX = mWidth - mDrawBitmapWidth; &#125; return; &#125; if (judgeY) &#123; mIsAddY = !mIsAddY; mIsAddX = mRandom.nextBoolean(); setRandomParm(); if (mY &lt;= 0) &#123; mY = 0; &#125; else &#123; mY = mHeight - mDrawBitmapHeight; &#125; &#125;&#125; â€‹ ä»¥ä¸Šå°±æ˜¯ç²’å­å¯¹è±¡å†…éƒ¨çš„è¿åŠ¨è½¨è¿¹å’Œè¾¹ç•Œåˆ¤æ–­ä»£ç äº†ï¼Œæ€æ ·ï¼Œæ˜¯ä¸æ˜¯è¶…çº§ç®€å•å‘¢ï¼Ÿ â€‹ å¥½äº†ï¼Œå¦‚æœä½ å–œæ¬¢æˆ‘çš„æ–‡ç« çš„è¯ï¼Œé‚£ä¹ˆè¯·ä¸è¦çŠ¹è±«ï¼Œç»™æˆ‘ä¸€ä¸ªstarå§ã€‚GitHubåœ°å€ï¼šè¿™é‡Œè¿™é‡Œï¼ï¼","path":"2017/06/28/android_partical/","date":"06-28","excerpt":"","tags":[{"name":"CanvasåŠ¨ç”»","slug":"CanvasåŠ¨ç”»","permalink":"https://yoursite.com/tags/CanvasåŠ¨ç”»/"},{"name":"Android","slug":"Android","permalink":"https://yoursite.com/tags/Android/"}],"preview":"https://raw.githubusercontent.com/JadynAi/oldpage.io/master/img/20170628-blog-header-bg.jpg"},{"title":"ä½æ¶ˆè€—ã€å¸¦å›æ»šåŠ¨ç”»çš„ä»¿æ¢æ¢äº¤äº’æ•ˆæœ","text":"åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ å‰æ®µæ—¶é—´é¡¹ç›®ä¸­æœ‰ä¸€ä¸ªä»¿æ¢æ¢çš„äº¤äº’ç•Œé¢ï¼Œå†™ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œè§‰å¾—æ•ˆæœè¿˜ä¸é”™ã€‚å°±æŠŠæ€è·¯å’ŒåŸç†è®°å½•äº†ä¸‹æ¥ï¼Œåˆ†äº«ä¸€ä¸‹ã€‚ å…ˆå¥‰ä¸ŠGitHubåœ°å€ï¼Œå¤§å®¶æ„Ÿå…´è¶£å¯ä»¥æ¥ä¸ªstarInfinateCard å¥—è·¯è¿˜æ˜¯è¦èµ°ä¸€ä¸‹çš„ï¼Œå…ˆç»™å¤§å®¶çœ‹ä¸€ä¸‹æ•ˆæœå›¾: çœŸæœºä¸Šä¸€ç‚¹éƒ½ä¸å¡ï¼ä¸€ç‚¹éƒ½ä¸å¡ï¼ä¸å¡ï¼ï¼ï¼ åˆå­¦ä¹ äº†ä¸€äº›å½•åˆ¶GIFçš„æ–¹æ³•ï¼Œè¿™æ¬¡æ¥ä¸€å¼ çœŸæœºçš„æ•ˆæœï¼ï¼ ä¼šç”¨åˆ°çš„çŸ¥è¯†ç‚¹ Recyclerviewçš„layoutManagerå®ç°å¸ƒå±€ ä½¿ç”¨ItemTouchHelperå¤„ç†æ»‘åŠ¨äº‹ä»¶ æ‰‹æŒ‡æ»‘åŠ¨è¿‡ç¨‹ä¸­ï¼Œviewçš„UIæ¸å˜ï¼ˆé€æ˜åº¦æˆ–è€…å…¶å®ƒï¼‰ RecyclerViewçš„ItemAnimatorå®ç°å›æ»šåŠ¨ç”» 1ã€LayoutMangerä¼—æ‰€å‘¨çŸ¥ï¼ŒRecyclerviewä¹‹æ‰€ä»¥å¼ºå¤§ï¼Œå®Œå…¨åœ¨äºå®ƒç™¾å˜çš„é€‚åº”æ€§ã€‚å®ƒèƒ½å®ç°ä»»ä½•ä½ æƒ³è¦çš„å¸ƒå±€æ ·å¼ï¼Œè€Œå®ƒçš„å¥¥ç§˜å°±åœ¨äºLayoutMangerã€‚ â€‹ æœ¬æ¬¡é¡¹ç›®ä¸­æˆ‘ä»¬UIæ•ˆæœä»¿ç…§æ¢æ¢çš„æ ·å¼ï¼Œæ˜¯å¡ç‰Œæ ·å¼çš„å †å æ•ˆæœï¼ŒæŒ‰ç…§Listé›†åˆçš„é¡ºåºæ²¿ç€Zè½´çºµå‘æ·±å¤„æ’åˆ—ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„Tipï¼Œå­viewæ˜¯æŒ‰ç…§listé›†åˆçš„é¡ºåºå»ç»˜åˆ¶çš„ï¼Œä¹Ÿå°±æ˜¯åœ¨è¿™ä¸ªæˆ‘ä»¬è‡ªå®šä¹‰çš„LayoutMangeré‡Œï¼Œç¬¬äºŒä¸ªviewä¼šè¦†ç›–ç¬¬ä¸€ä¸ªï¼Œç¬¬ä¸‰ä¸ªä¼šè¦†ç›–ç¬¬äºŒä¸ªï¼Œä»¥æ­¤ç±»æ¨ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦ç¬¬ä¸€çœ¼å°±çœ‹åˆ°Listé›†åˆçš„ç¬¬ä¸€ä¸ªï¼Œé‚£ä¹ˆå¿…é¡»å°†listé›†åˆreverseåï¼Œå†æ¥ç»˜åˆ¶ã€‚ â€‹ å¥½äº†ï¼Œæˆ‘ä»¬æ¥çœ‹ä»£ç ã€‚LayoutMangerçš„ç²¾é«“å…¶å®å°±åœ¨äºonLayoutChildrenï¼ˆâ€¦â€¦ï¼‰è¿™ä¸ªæ–¹æ³•ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥å®ç°è‡ªå®šä¹‰çš„å¸ƒå±€ã€‚ 12345678910111213141516171819@Overridepublic void onLayoutChildren(RecyclerView.Recycler recycler, RecyclerView.State state) &#123; int itemCount = getItemCount(); // ä»£ç çš„ç¨³å¥ä¹‹é“ï¼Œå°±åœ¨äºè¯¥ä¿æŠ¤çš„åœ°æ–¹ä¸€å®šè¦ä¿æŠ¤ if (itemCount == 0) &#123; return; &#125; detachAndScrapAttachedViews(recycler); for (int position = 0; position &lt; itemCount; position++) &#123; View view = recycler.getViewForPosition(position); addView(view); measureChildWithMargins(view, 0, 0); int widthSpace = getWidth() - getDecoratedMeasuredWidth(view); int heightSpace = getHeight() - getDecoratedMeasuredHeight(view); // recyclerview å¸ƒå±€ layoutDecoratedWithMargins(view, widthSpace / 2, heightSpace / 2, widthSpace / 2 + getDecoratedMeasuredWidth(view), heightSpace / 2 + getDecoratedMeasuredHeight(view)); &#125; â€‹ å¾ˆå¤šäººçœ‹åˆ°è¿™é‡Œï¼Œè‚¯å®šä¼šå–·å‡ºä¸€å¥â€œå§æ§½ï¼è¿™å°±å®Œäº†ï¼Œå°±è¿™ç‚¹ä»£ç ï¼Ÿâ€ â€‹ æ²¡é”™ï¼Œå¦‚æœä¸è¿½æ±‚ç²¾ç»†çš„è¯ï¼Œè¿™ç‚¹ä»£ç ç¡®å®å¯ä»¥æå®šè¿™ä¸ªå¸ƒå±€æ ·å¼ã€‚ç°åœ¨æˆ‘ä»¬æ¥é€è¡Œåˆ†æä¸€ä¸‹ä»£ç ã€‚ detachAndScrapAttachedViews(recycler)è¿™ä¸ªæ–¹æ³•å°±æ˜¯å°†æ‰€æœ‰çš„viewç¼“å­˜åœ¨scrapé‡Œã€‚Recyclerviewæœ‰äºŒçº§ç¼“å­˜ï¼Œscrapå’ŒRecycleã€‚ä½¿ç”¨Detachæ–¹å¼å¤„ç†çš„viewç¼“å­˜åœ¨scrapé‡Œï¼Œç”¨çš„æ—¶å€™ä¸éœ€è¦é‡æ–°ç»‘å®šæ•°æ®ã€‚Removeæ–¹å¼å¤„ç†çš„viewç¼“å­˜åœ¨Recycleé‡Œï¼Œä½¿ç”¨çš„æ—¶å€™ä¼šé‡æ–°ç»‘å®šæ•°æ®ã€‚ æ¥ä¸‹æ¥çš„forå¾ªç¯ä»£ç å°±ç®€å•çš„å¤šäº†ï¼Œæ— éå°±æ˜¯è·å¾—viewçš„å®½é«˜ä¿¡æ¯ï¼Œå°†å…¶å¸ƒå±€åœ¨Recyclerviewå†… å½“ç„¶ï¼Œå¦‚æœåªæ˜¯ä»¥ä¸Šé‚£äº›ç®€å•çš„ä»£ç ï¼Œæœªå…ä¹Ÿå¤ªå¯¹ä¸èµ·Recyclerviewäº†ã€‚æ¯•ç«ŸRecyclerviewæœ€å¼ºå¤§çš„åœ°æ–¹å°±æ˜¯å¯¹viewçš„å›æ”¶å’Œåˆ©ç”¨äº†ï¼Œè¦ä¸ç„¶ä¸ºä»€ä¹ˆå«Recyclerå‘¢ã€‚ å¯¹å­viewçš„å›æ”¶åˆ©ç”¨â€‹ é¦–å…ˆè¿™ç§å¡ç‰Œå å±‚çš„äº¤äº’æ¨¡å¼ï¼Œä¸éœ€è¦å±•ç¤ºé‚£ä¹ˆå¤šçš„viewï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä»…ä»…éœ€è¦è®©å‰å‡ ä¸ªviewå±•ç¤ºå‡ºæ¥å°±å¯ä»¥äº†ã€‚å…¶ä»–çš„viewï¼Œæ”¾åœ¨scrapç¼“å­˜é‡Œå³å¯ã€‚ 12345678910111213141516171819202122232425262728293031@Overridepublic void onLayoutChildren(RecyclerView.Recycler recycler, RecyclerView.State state) &#123; int itemCount = getItemCount(); // ä»£ç çš„ç¨³å¥ä¹‹é“ï¼Œå°±åœ¨äºè¯¥ä¿æŠ¤çš„åœ°æ–¹ä¸€å®šè¦ä¿æŠ¤ if (itemCount == 0) &#123; return; &#125; detachAndScrapAttachedViews(recycler); // æµ‹é‡å­viewçš„ä½ç½®ä¿¡æ¯å¹¶å‚¨å­˜ for (int position = 0; position &lt; itemCount; position++) &#123; // æ ¹æ®positionè·å–ä¸€ä¸ªç¢ç‰‡viewï¼Œå¯ä»¥ä»å›æ”¶çš„viewä¸­è·å–ï¼Œä¹Ÿå¯èƒ½æ–°æ„é€ ä¸€ä¸ª View view = recycler.getViewForPosition(position); Log.d(TAG, &quot;recycler&quot; + view.getTag().toString()); addView(view); if (mViewInfo == null) &#123; // è®¡ç®—æ­¤ç¢ç‰‡viewåŒ…å«è¾¹è·çš„å°ºå¯¸ measureChildWithMargins(view, 0, 0); // getDecoratedMeasuredWidthæ–¹æ³•æ˜¯è·å–æ­¤ç¢ç‰‡viewåŒ…å«è¾¹è·å’Œè£…é¥°çš„å®½åº¦width int widthSpace = getWidth() - getDecoratedMeasuredWidth(view); int heightSpace = getHeight() - getDecoratedMeasuredHeight(view); mViewInfo = new Rect(); int left = widthSpace / 2; int top = heightSpace / 2; int right = widthSpace / 2 + getDecoratedMeasuredWidth(view); int bottom = heightSpace / 2 + getDecoratedMeasuredHeight(view); mViewInfo.set(left, top, right, bottom); &#125; detachAndScrapView(view, recycler); &#125; LayoutItems(recycler, state);&#125; æˆ‘ä»¬å°†viewçš„ä½ç½®ä¿¡æ¯ä½¿ç”¨ä¸€ä¸ªRectå¯¹è±¡æ¥ä¿å­˜ï¼Œå› ä¸ºlayoutDecorated(View child, int left, int top, int right, int bottom)è¿™ä¸ªå‡½æ•°çš„å‚æ•°æ˜¯æ•´å‹ã€‚Rectå’ŒRecFä¸¤ä¸ªå¯¹è±¡æœ€å¤§çš„åŒºåˆ«å°±æ˜¯ç²¾åº¦åŒºåˆ«äº†ã€‚ ç„¶åå°†æ¯ä¸ªå­viewé€šè¿‡æ–¹æ³•detachAndScrapViewç¼“å­˜åˆ°scrapå†… æœ€åé€šè¿‡LayoutItems(recycler, state)æ–¹æ³•å°†éœ€è¦å±•ç¤ºçš„viewå±•ç¤ºå‡ºæ¥ï¼Œæ³¨é‡Šå·²ç»å¾ˆæ¸…æ¥šäº†å“ˆ 1234567891011121314151617181920212223/** * å›æ”¶ä¸éœ€è¦çš„Itemï¼Œå¹¶ä¸”å°†éœ€è¦æ˜¾ç¤ºçš„Itemä»ç¼“å­˜ä¸­å–å‡º */private void LayoutItems(RecyclerView.Recycler recycler, RecyclerView.State state) &#123; // å½“æ•°é‡å¤§äºä¸´ç•Œç‚¹æ‰éœ€è¦å›æ”¶view boolean isMeetNum = getItemCount() &gt; CardConfig.MAX_SHOW_INDEX + 1; if (isMeetNum) &#123; for (int i = CardConfig.MAX_SHOW_INDEX + 1; i &lt; getItemCount(); i++) &#123; View child = recycler.getViewForPosition(i); removeAndRecycleView(child, recycler); &#125; &#125; // å±•ç¤ºéœ€è¦å±•ç¤ºçš„view for (int i = isMeetNum ? CardConfig.MAX_SHOW_INDEX : getItemCount() - 1; i &gt;= 0; i--) &#123; View scrap = recycler.getViewForPosition(i); measureChildWithMargins(scrap, 0, 0); addView(scrap); //å°†è¿™ä¸ªitemå¸ƒå±€å‡ºæ¥ layoutDecorated(scrap, mViewInfo.left, mViewInfo.top, mViewInfo.right, mViewInfo.bottom); int translateY = i * CardConfig.CARD_VERTICAL_GAP; ViewCompat.setTranslationY(scrap, -translateY); &#125;&#125; è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œå°†ä¸éœ€è¦å±•ç¤ºçš„viewå…¨éƒ¨removeï¼Œç„¶åå°†éœ€è¦å±•ç¤ºçš„viewå¸ƒå±€å‡ºæ¥ã€‚ 2ã€ä½¿ç”¨ItemTouchHelperå®ç°æ»‘åŠ¨â€‹ ItemTouchHelperæ˜¯ä¸€ä¸ªä¸ºRecyclerviewæä¾› Swipeã€dragã€dropäº‹ä»¶çš„å·¥å…·ç±»ã€‚ä½¿ç”¨æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œæ¨èå¤§å®¶çœ‹æ³¡ç½‘çš„è¿™ä¸€ç‰‡å…¥é—¨æ–‡ç« ï¼Œæ€è·¯å¾ˆæ¸…æ™°ã€‚ â€‹ æœ¬æ¬¡é¡¹ç›®ä¸­ä½¿ç”¨çš„æ˜¯ItemTouchHelperæœ¬èº«æä¾›çš„ä¸€ä¸ªå¸®åŠ©ç±» SimpleCallbackï¼Œä½¿ç”¨æ–¹æ³•å…¶å®å¾ˆç®€å•ã€‚å®ƒçš„æ„é€ å‚æ•°æœ‰ä¸¤ä¸ªå€¼ï¼Œä¸€ä¸ªæ˜¯dragDirsé•¿æŒ‰çš„æ–¹å‘ï¼Œå¦ä¸€ä¸ªæ˜¯swipeDirsæ»‘åŠ¨çš„æ–¹å‘ã€‚å¯ä»¥çœ‹çœ‹SImpleCallBackçš„æºç ï¼š 1234public SimpleCallback(int dragDirs, int swipeDirs) &#123; mDefaultSwipeDirs = swipeDirs; mDefaultDragDirs = dragDirs;&#125; â€‹ è€Œæˆ‘ä»¬åªéœ€è¦æ»‘åŠ¨ï¼Œæ‰€ä»¥æ„é€ å‚æ•°ä¸­åªéœ€è¦å®ç° swipe å³å¯ï¼š 12//ä¸æ”¯æŒé•¿æŒ‰æ‹–æ‹½ï¼Œæ”¯æŒswipeï¼Œè€Œä¸”å››ä¸ªæ–¹å‘çš†å¯ä»¥swipethis(0, ItemTouchHelper.UP | ItemTouchHelper.DOWN | ItemTouchHelper.LEFT | ItemTouchHelper.RIGHTï¼‰ â€‹ ç„¶ååº”ç”¨æ­¤ ItemTouchHelper å³å¯ï¼š 123CardItemTouchHelperCallback cardCallback = new CardItemTouchHelperCallback(mRecyclerView, mRecyclerView.getAdapter(), list);ItemTouchHelper touchHelper = new ItemTouchHelper(cardCallback);touchHelper.attachToRecyclerView(mRecyclerView); â€‹ åˆ°è¿™é‡Œ Recyclerviewå·²ç»å®ç°äº†å››ä¸ªæ–¹å‘çš„æ»‘åŠ¨äº†ï¼Œä½†æ»‘åŠ¨ä¹‹åçš„æ“ä½œè¿˜éœ€è¦å†å®ç°ä¸€ä¸‹ã€‚æˆ‘ä»¬åœ¨ onSwiped(RecyclerView.ViewHolder viewHolder, int direction) æ–¹æ³•ä¸­å®ç° swipeä¹‹åçš„æ“ä½œã€‚è¿™ä¸ªæ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼ŒviewHolderä»£è¡¨çš„å°±æ˜¯æ­¤æ—¶æ»‘åŠ¨çš„viewholderï¼Œdirection ä»£è¡¨çš„æ˜¯è¿™ä¸ªviewæœ€ç»ˆæ»‘åŠ¨çš„æ–¹å‘ã€‚åœ¨è¿™ä¸ªæ–¹æ³•é‡Œï¼Œæˆ‘ä»¬å¯¹æ•°æ®æºè¿›è¡Œæ“ä½œï¼Œç„¶ååˆ·æ–°åˆ—è¡¨ã€‚ åœ¨Recyclerviewçš„Adapterçš„æ•°æ®åˆ·æ–°ä¸Šï¼Œæˆ‘ä½¿ç”¨äº†æ‰©å±•åŒ…æä¾›çš„ DiffUtils,æ˜¯googleæä¾›çš„æ›¿æ¢ notifyDataSetChanged()æ— è„‘åˆ· çš„æ–¹æ¡ˆã€‚ â€‹ æœ€ååœ¨ onChildDraw(Canvas c, RecyclerView recyclerView, RecyclerView.ViewHolder viewHolder, float dX, float dY, int actionState, boolean isCurrentlyActive) æ–¹æ³•ä¸­å®ç°æ»‘åŠ¨æ—¶çš„åŠ¨ç”»ã€‚è¿™ä¸ªæ–¹æ³•æœ‰å¤šè¾¾ä¸ƒä¸ªå‚æ•°ï¼Œæˆ‘æ¥ä¾æ¬¡è§£é‡Šä¸€ä¸‹ï¼š c ï¼ŒRecyclerviewç”¨æ¥ç»˜åˆ¶childrençš„ç”»ç¬” recyclerViewï¼Œé¢â€¦â€¦å°±æ˜¯æ‰€ä¾èµ–çš„Recyclerview viewHolderï¼Œå½“ä¸‹æ»‘åŠ¨çš„è¿™ä¸ªviewçš„viewHolder dXã€dYï¼Œæ‰‹æŒ‡åœ¨æ§åˆ¶æ»‘åŠ¨çš„æ—¶å€™ï¼Œæ­¤viewæ°´å¹³Xè½´å’Œå‚ç›´Yè½´ä½ç§»çš„è·ç¦»ï¼Œå•ä½åƒç´  actionStateï¼Œæ ‡æ˜æ­¤æ—¶æ˜¯é•¿æŒ‰æ‹–æ‹½è¿˜æ˜¯å•çº¯çš„swipe isCurrentlyActiveï¼Œæ ‡æ˜æ­¤æ—¶æ»‘åŠ¨çš„viewæ˜¯å¤„äºæ‰‹æŒ‡æ§åˆ¶çŠ¶æ€ï¼Œè¿˜æ˜¯æ‰‹æŒ‡æ¾å¼€åçš„å›å¼¹åŠ¨ç”»çŠ¶æ€ â€‹ äº†è§£äº†å‚æ•°ä¹‹åï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­å°±å¯ä»¥å®ç°æ»‘åŠ¨æ—¶çš„åŠ¨ç”»äº†ã€‚SimpleCallBack é»˜è®¤çš„å¯¹æ»‘åŠ¨è·ç¦»åˆ¤æ–­çš„æ¡ä»¶æ˜¯ï¼Œæ°´å¹³æ–¹å‘æ˜¯Recyclerviewå®½çš„ä¸€åŠï¼Œå‚ç›´æ–¹å‘æ˜¯Recyclerviewé«˜çš„ä¸€åŠã€‚ 1234//è¿™ä¸ªæ–¹æ³•è¿”å›çš„å€¼å°±æ˜¯é»˜è®¤çš„é˜™å€¼ï¼Œæƒ³è¦æ›´çµæ•çš„è¯åªéœ€åœ¨è‡ªå®šä¹‰CallBackä¸­é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œå°†å€¼å˜å°ã€‚æ›´è¿Ÿé’çš„è¯åˆ™åä¹‹public float getSwipeThreshold(ViewHolder viewHolder) &#123; return .5f;&#125; â€‹ æ’¸å‡ºæ¥çš„ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132@Override public void onChildDraw(Canvas c, RecyclerView recyclerView, RecyclerView.ViewHolder viewHolder, float dX, float dY, int actionState, boolean isCurrentlyActive) &#123; super.onChildDraw(c, recyclerView, viewHolder, dX, dY, actionState, isCurrentlyActive);// Log.d(TAG, &quot;onChildDraw dX : &quot; + dX);// Log.d(TAG, &quot;onChildDraw dY : &quot; + dY); Log.d(TAG, &quot;onChildDraw isCurrentlyActive: &quot; + isCurrentlyActive); if (mItemW == 0) &#123;// Log.d(TAG, &quot;onChildDraw getAdapterPosition : &quot; + viewHolder.getAdapterPosition()); mItemW = viewHolder.itemView.getWidth(); mHorJudgeDistance = recyclerView.getWidth() * getSwipeThreshold(viewHolder); mVerJudgeDistance = recyclerView.getHeight() * getSwipeThreshold(viewHolder); &#125; float ratio; if (Math.abs(dX) &gt; Math.abs(dY)) &#123; //ä»¥å®½ä¸ºåˆ¤å®šåŸºå‡† ratio = Math.abs(dX) / mHorJudgeDistance; &#125; else &#123; //ä»¥é«˜ä¸ºåˆ¤å®šåŸºå‡† ratio = Math.abs(dY) / mVerJudgeDistance; &#125; float realRatio = ratio &gt;= 1f ? 1f : ratio; ViewCompat.setAlpha(viewHolder.itemView, 1 - realRatio); boolean isMeetNum = recyclerView.getLayoutManager().getItemCount() &gt; CardConfig.MAX_SHOW_COUNT + 1; int maxJudge = isMeetNum ? CardConfig.MAX_SHOW_COUNT - 1 : (recyclerView.getLayoutManager().getItemCount() - 1); for (int i = 1; i &lt;= maxJudge; i++) &#123; View itemView = recyclerView.findViewHolderForAdapterPosition(i).itemView; float v = i * CardConfig.CARD_VERTICAL_GAP - realRatio * CardConfig.CARD_VERTICAL_GAP; ViewCompat.setTranslationY(itemView, -v); &#125; &#125; 3ã€ä½¿ç”¨ItenAnimatorå®ç°å›æ»šåŠ¨ç”»â€‹ ItemAnimator æˆ‘æ²¡æœ‰é€‰æ‹©å®ç°ï¼Œè€Œæ˜¯ä½¿ç”¨äº†ç°æˆçš„è½®å­recyclerview-animatorsï¼Œæ²¡æœ‰é€‰æ‹©è¿œç¨‹åº“å¼•å…¥ã€‚è€Œæ˜¯å°†æºä»£ç copyè¿›æ¥ï¼Œå†è¿›è¡Œäº†é€‚å½“æ€§çš„ä¿®æ”¹ã€‚ 12mRecyclerView.setItemAnimator(new SlideAnimator());mRecyclerView.getItemAnimator().setAddDuration(250); â€‹ OKï¼Œåˆ°è¿™é‡ŒåŸºæœ¬ä¸Šå°±å¤§åŠŸå‘Šæˆäº†ï¼Œåªå‰©ä¸‹ä¸€äº›å°ç»†èŠ‚å’Œbugå¤„ç†ä¸€ä¸‹å³å¯ã€‚åœ¨CallBack ç±»çš„ onSwipe æ–¹æ³•ä¸­å°† direction èµ‹å€¼åˆ°ä¸€ä¸ªé™æ€å˜é‡ä¸­ï¼Œç„¶ååœ¨ SlideAnimator æ ¹æ®ä¸åŒçš„æ–¹å‘å®ç°ä¸åŒçš„åŠ¨ç”»ã€‚ â€‹ åœ¨å®ç°è¿‡ç¨‹ä¸­ï¼Œæˆ‘å‘ç°å›æ»šåŠ¨ç”»çš„é‚£ä¸ªviewå±…ç„¶ä¸æ˜¯æ»‘èµ°çš„viewï¼Œå°±ä½¿ç”¨äº†ä¸€ä¸ªå•ä¾‹æ¥ç®¡ç†æ•°æ®ã€‚åŠ¨ç”»å¼€å§‹æ—¶å°†æ•°æ®è®¾ç½®ä¸ºæ»‘èµ°çš„viewçš„æ•°æ®ï¼ŒåŠ¨ç”»ç»“æŸåå†å°†åŠ¨ç”»viewçš„æ•°æ®è¿˜åŸã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758@Overrideprotected void preAnimateAddImpl(RecyclerView.ViewHolder holder) &#123; Log.d(TAG, &quot;preAnimateAddImpl: &quot; + holder.itemView.getTag().toString()); DataExchangeMgr.getInstance().saveOrignData((int) holder.itemView.getTag(R.id.view_data)); //æ ¹æ®ä¸åŒçš„æ–¹å‘è®¾ç½®ä¸åŒçš„åˆå§‹å€¼ if (isHorizDirection()) &#123; int width = holder.itemView.getRootView().getWidth(); ViewCompat.setTranslationX(holder.itemView, CardConfig.sViewholderDirection == ItemTouchHelper.LEFT ? -width : width); &#125; else &#123; int height = holder.itemView.getRootView().getHeight(); ViewCompat.setTranslationY(holder.itemView, CardConfig.sViewholderDirection == ItemTouchHelper.UP ? -height : height); &#125;&#125;@Overrideprotected void animateAddImpl(final RecyclerView.ViewHolder holder) &#123; //æ ¹æ®ä¸åŒçš„æ–¹å‘é€‰æ‹©ä¸åŒçš„åŠ¨ç”» ViewPropertyAnimatorCompat viewPropertyAnimatorCompat = ViewCompat.animate(holder.itemView) .setDuration(getAddDuration()) .setInterpolator(mInterpolator) .setListener(new DefaultAddVpaListener(holder) &#123; @Override public void onAnimationStart(View view) &#123; super.onAnimationStart(view); //å°†æ­¤viewæ•°æ®è®¾ç½®ä¸ºæ»‘å¼€çš„æ•°æ® ((ImageView) mViewHolder.itemView.findViewById(R.id.show_img)).setImageResource(DataExchangeMgr.getInstance().getCurrentData()); &#125; @Override public void onAnimationCancel(View view) &#123; super.onAnimationCancel(view); //æ•°æ®è¿˜åŸ ((ImageView) mViewHolder.itemView.findViewById(R.id.show_img)).setImageResource(DataExchangeMgr.getInstance().getOrignalData()); &#125; @Override public void onAnimationEnd(View view) &#123; super.onAnimationEnd(view); //æ•°æ®è¿˜åŸ ((ImageView) mViewHolder.itemView.findViewById(R.id.show_img)).setImageResource(DataExchangeMgr.getInstance().getOrignalData()); &#125; &#125;) .setStartDelay(50); if (isHorizDirection()) &#123; viewPropertyAnimatorCompat .translationX(0) .start(); &#125; else &#123; viewPropertyAnimatorCompat .translationY(0) .start(); &#125;&#125;private boolean isHorizDirection() &#123; return CardConfig.sViewholderDirection == ItemTouchHelper.LEFT || CardConfig.sViewholderDirection == ItemTouchHelper.RIGHT;&#125; æœ€åæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹ä»£ç ï¼Œå¥‰ä¸ŠGitHubåœ°å€ã€‚InfinateCard","path":"2017/05/10/android-infinite-card/","date":"05-10","excerpt":"","tags":[{"name":"Android","slug":"Android","permalink":"https://yoursite.com/tags/Android/"},{"name":"äº¤äº’ä½“éªŒ","slug":"äº¤äº’ä½“éªŒ","permalink":"https://yoursite.com/tags/äº¤äº’ä½“éªŒ/"}],"preview":"https://raw.githubusercontent.com/JadynAi/oldpage.io/master/img/20170510-blog-header-bg.jpg"},{"title":"Androidè¤ç«è™«é£èˆç²’å­æ•ˆæœ","text":"GitHubåœ°å€ åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ è¤ç«è™«é£èˆç²’å­æ•ˆæœ æœ¬é¡¹ç›®ä¸­æˆ‘æä¾›äº†ä¸¤ç§æ–¹æ¡ˆï¼Œæœ€ç»ˆå‘ˆç°çš„æ•ˆæœå¦‚ä¸‹ï¼š å…ˆå¥‰ä¸ŠGitHubåœ°å€æˆ³è¿™é‡Œï¼Œæœ‰å…´è¶£çš„åŒé‹starä¸€ä¸‹å’¯ å®ç°åŸç†Androidçš„ç²’å­æ•ˆæœã€ç²’å­åŠ¨ç”»ï¼Œå·²ç»æœ‰å¾ˆå¤šå¼€æºçš„è½®å­äº†ã€‚ä½œä¸ºä¸€ä¸ªåšå®šçš„è½®å­ä¸»ä¹‰è€…ï¼Œæˆ‘googleäº†å¤§åŠå¤©ï¼Œå´æ²¡æœ‰æ‰¾åˆ°è¿™ç§ç±»ä¼¼äºè¤ç«è™«é£èˆçš„æ•ˆæœã€‚åªå¥½è‡ªå·±æ¥å®ç°è¿™ç§æ•ˆæœã€‚ ç›¸æ¯”è¾ƒæ™®é€šçš„Viewï¼ŒSurfaceViewæ›´åŠ é€‚åˆè¿™ç§ä¸æ–­å˜åŒ–çš„ç”»é¢ï¼Œæ‰€ä»¥é€‰æ‹©SurfaceViewæ¥å®ç°ã€‚ç°åœ¨æŠŠæ€è·¯å†é‡æ–°æ¢³ç†ä¸€ä¸‹ï¼š å¤§å°ä¸åŒçš„ç²’å­åœ¨åŒºåŸŸå†…éšæœºåˆ†å¸ƒ ç²’å­åšæ— è§„åˆ™è¿åŠ¨ï¼Œç„¶åæ¶ˆå¤± ç²’å­åŒºåŸŸå†…éšæœºåˆ†å¸ƒè¿™ä¸ªç®€å•ï¼Œæˆ‘ä»¬åœ¨callBackçš„æ–¹æ³•å†…ç›´æ¥å¾ªç¯ç”Ÿæˆä¸€ä¸ªç²’å­çš„æ•°ç»„å³å¯ã€‚æ–¹ä½çš„è¯ä½¿ç”¨Randomå³å¯ã€‚ 1234567891011121314151617if (mCircles.size() == 0) &#123; for (int i = 0; i &lt; MAX_NUM; i++) &#123; FloatParticleLine f = new FloatParticleLine(getF() * mMeasuredWidth, getF() * mMeasuredHeight, mMeasuredWidth, mMeasuredHeight); f.setRadius(mRandom.nextInt(2) + 1.2f); mCircles.add(f); &#125;&#125;private float getF() &#123; float v = mRandom.nextFloat(); if (v &lt; 0.2f) &#123; return v + 0.2f; &#125; else if (v &gt;= 0.85f) &#123; return v - 0.2f; &#125; else &#123; return v; &#125; &#125; getFï¼ˆï¼‰æ–¹æ³•æ˜¯é™åˆ¶åœ¨åŒºåŸŸå†…å–å€¼ï¼ŒmMeasuredWidthã€mMeasuredHeightä¸ºSurfaceViewçš„å®½å’Œé«˜ã€‚ è¿™é‡Œçš„å®½å’Œé«˜åœ¨ç²’å­å¯¹è±¡FloatParticleLineï¼Œå†…ä¼šç”¨åˆ°ã€‚ ç„¶åæˆ‘ä»¬åœ¨åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨runï¼ˆï¼‰æ–¹æ³•å†…åšæ— çº¿å¾ªç¯çš„ç»˜åˆ¶å³å¯ï¼Œä¸ºäº†é¿å…æ— æ„ä¹‰çš„ç»˜åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨Thread.sleepæ–¹æ³•æ¥æ§åˆ¶å¸§æ•°ã€‚ 1234567891011121314151617181920212223while (isRun) &#123; try &#123; mCanvas = mHolder.lockCanvas(null); if (mCanvas != null) &#123; synchronized (mHolder) &#123; // æ¸…å± mCanvas.drawColor(Color.TRANSPARENT, PorterDuff.Mode.CLEAR); for (FloatParticleLine circle : mCircles) &#123; circle.drawItem(mCanvas); &#125; // æ§åˆ¶å¸§æ•° Thread.sleep(25); &#125; &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; if (mCanvas != null) &#123; mHolder.unlockCanvasAndPost(mCanvas); &#125; &#125;&#125; isRunçš„å˜é‡æˆ‘ä»¬ä¼šåœ¨SurfaceViewå†…callBackçš„surfaceDestroyedæ–¹æ³•ä¸­ç½®ä¸ºfalse ç²’å­åšæ— è§„åˆ™è¿åŠ¨ æ–¹æ¡ˆä¸€ å…¶å®çœ‹åˆ°è¿™ç§ç²’å­æ•ˆæœï¼Œé¦–å…ˆåº”è¯¥æƒ³åˆ°çš„å°±æ˜¯Canvasäº†ã€‚ åœ¨SurfaceViewé‡Œå°±æ˜¯é€šè¿‡ä¸æ–­åœ°å¾ªç¯è°ƒç”¨FloatParticleLineç±»çš„drawItemï¼ˆï¼‰æ–¹æ³•æ¥å®ç°ç²’å­çš„è¿åŠ¨ã€‚æˆ‘ç¬¬ä¸€ç§æ–¹æ¡ˆçš„å®ç°ï¼Œå°±æ˜¯æ¯ä¸€ä¸ªç²’å­åœ¨è¢«åˆ›å»ºå‡ºæ¥çš„æ—¶å€™ï¼Œå°±éšæœºé€‰æ‹©ä¸€ä¸ªæ–¹å‘å¼€å§‹è¿åŠ¨ï¼Œæ»‘è¿‡ä¸€å®šçš„è½¨è¿¹ä¹‹åè®©å…¶æ¶ˆå¤±å°±å¥½äº†ã€‚ è‡³äºæ€ä¹ˆé€‰æ‹©éšæœºæ–¹å‘ï¼Œæˆ‘è¿™é‡Œçš„åšæ³•æ˜¯ï¼Œåˆ†åˆ«éšæœºç”Ÿæˆä¸€ä¸ªxå’Œyè½´ä¸Šçš„é€’å¢æˆ–è€…é€’å‡çš„æ•°å€¼ï¼Œç„¶åæ¯æ¬¡åœ¨å‰ä¸€æ¬¡ç»˜åˆ¶çš„åŸºç¡€ä¸Šï¼Œxå’Œyåˆ†åˆ«é€’å¢é€’å‡ï¼Œç›´åˆ°è¿åŠ¨åˆ°å±å¹•è¾¹ç¼˜æˆ–è€…æ˜¯è§„å®šçš„è¿åŠ¨è·ç¦»æ»¡è¶³äº†å†æ¶ˆå¤±å³å¯ã€‚ 12345678910111213//éšæœºç”Ÿæˆå‚æ•°private void setRandomParm() &#123; // 2017/5/2-ä¸Šåˆ10:47 xå’Œyçš„æ–¹å‘ mIsAddX = mRandom.nextBoolean(); mIsAddY = mRandom.nextBoolean(); // 2017/5/2-ä¸Šåˆ10:47 xå’Œyçš„å–å€¼ mDisX = mRandom.nextInt(2) + 0.2f; mDisY = mRandom.nextInt(2) + 0.3f; // 2017/5/2-ä¸Šåˆ10:47 å†…éƒ¨åŒºåŸŸçš„è¿åŠ¨æœ€è¿œè·ç¦» mDistance = mRandom.nextInt((int) (0.25f * mWidth)) + (0.125f * mWidth);&#125; ç»˜åˆ¶å›¾å½¢ï¼š 1234567891011121314151617181920212223242526272829303132public void drawItem(Canvas canvas) &#123; if (mX == mStartX) &#123; mPaint.setAlpha(ALPHA_MAX); &#125; //ç»˜åˆ¶ canvas.drawCircle(mX += getPNValue(mIsAddX, mDisX), mY += getPNValue(mIsAddY, mDisY), mRadius, mPaint); //å†…éƒ¨åŒºåŸŸè¿åŠ¨åˆ°ä¸€å®šè·ç¦»æ¶ˆå¤± if (judgeInner()) &#123; float gapX = Math.abs(mX - mStartX); float ratio = 1 - (gapX / mDistance); mPaint.setAlpha((int) (255 * ratio)); mRadius = mStartRadius * ratio; if (gapX &gt;= mDistance || mY - mStartY &gt;= mDistance) &#123; resetDisXY(); return; &#125; return; &#125; //å¤–éƒ¨åŒºåŸŸè¿åŠ¨åˆ°å±å¹•è¾¹ç¼˜æ¶ˆå¤± if (judgeOutline()) &#123; resetDisXY(); &#125;&#125;private void resetDisXY() &#123; setRandomParm(); mPaint.setAlpha(0); mX = mStartX; mY = mStartY; mRadius = mStartRadius; &#125; judgeInner()å’ŒjudgeOutline()æ˜¯åˆ¤æ–­åŒºåŸŸçš„æ–¹æ³•ï¼Œå†…éƒ¨åŒºåŸŸçš„ç‚¹å’Œå¤–éƒ¨åŒºåŸŸçš„åº—æ¶ˆå¤±æ—¶æœºä¸åŒ åœ¨é€æ˜åº¦ä¸º0ä¹Ÿå°±æ˜¯ç²’å­æ¶ˆå¤±æ—¶ï¼Œè®©ç²’å­å›åˆ°åŸç‚¹ï¼Œå†é‡æ–°é€‰æ‹©ä¸€ä¸ªæ–¹å‘ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥è¿åŠ¨è½¨è¿¹ã€‚ æ–¹æ¡ˆäºŒ æ–¹æ¡ˆäºŒç²’å­åšçš„è¿åŠ¨æ˜¯è´å¡å°”æ›²çº¿ï¼Œå‡½æ•°å®åœ¨ç½‘ä¸Šæ‰¾åˆ°çš„ä¸€ä¸ªå‡½æ•°ã€‚æ¯å½“ç²’å­åšå®Œä¸€æ¬¡æ›²çº¿è¿åŠ¨åï¼Œå†éšæœºç”Ÿæˆä¸€æ®µæ–°çš„è´å¡å°”æ›²çº¿å³å¯ã€‚ æ€è·¯å’Œæ–¹æ¡ˆä¸€çš„æ€è·¯éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ— éå°±æ˜¯è¿åŠ¨çš„è½¨è¿¹ä¸åŒè€Œå·²ã€‚ æ€»ç»“åšå®Œä¹‹åå›å¤´å†çœ‹ï¼Œå‘ç°è¿™ä¸ªé¡¹ç›®çš„åŸç†å…¶å®å¹¶ä¸éš¾ï¼Œå¯ä»¥è¯´æ˜¯ç®€å•äº†ã€‚ä½†åˆšå¼€å§‹èµ·æ­¥çš„æ—¶å€™çœŸçš„è¿˜æ˜¯æ¯”è¾ƒæ‡µçš„ï¼ŒåŸå› å°±æ˜¯æ²¡æœ‰æ€è·¯ã€‚ æ‰€ä»¥åšä»»ä½•æ•ˆæœï¼Œæ€è·¯æœ€é‡è¦ã€‚","path":"2017/04/28/android-firefly/","date":"04-28","excerpt":"","tags":[{"name":"CanvasåŠ¨ç”»","slug":"CanvasåŠ¨ç”»","permalink":"https://yoursite.com/tags/CanvasåŠ¨ç”»/"},{"name":"Android","slug":"Android","permalink":"https://yoursite.com/tags/Android/"}],"preview":"https://raw.githubusercontent.com/JadynAi/oldpage.io/master/img/20170428-blog-header-bg.jpg"},{"title":"Hello World","text":"Hello World","path":"2017/04/28/hello-world/","date":"04-28","excerpt":"","tags":[]}]}